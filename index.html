<!DOCTYPE html>
<html>
  <head>
    <title>ARIEL</title>
    <base target="_top">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"    
      integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" 
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" 
      integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" 
      integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12"></script>

    <style>
      /* 共通スタイル */
      html, body {
        margin: 0;
        height: 100%;
        overflow: hidden;
        background-color: #343a40;
        color: white;
      }

      /* メインアプリスタイル */
      #app {
        height: 100%;
        overflow: hidden;
        display: none; /* 最初は非表示 */
      }

      .fullscreen-appsheet {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        z-index: 1;
      }

      .fullscreen-appsheet iframe {
        width: 100%;
        height: 100%;
        border: none;
      }
      
      /* AppSheetヘルパーのスタイル */
      .appsheet-helper {
        opacity: 0.95;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        transition: opacity 0.3s ease;
        z-index: 1000;
      }
      
      .appsheet-helper:hover {
        opacity: 1;
      }

      #nav-hover-zone {
        position: fixed;
        top: 0;
        left: 0;
        height: 30px;
        width: 100vw;
        background: transparent;
        z-index: 100;
        pointer-events: auto;
      }

      #nav-hover-bar {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 40px;
        background-color: #343a40;
        color: white;
        z-index: 101;
        transform: translateY(-100%);
        transition: transform 0.4s ease-in-out;
        pointer-events: auto;
      }

      #nav-hover-bar.active {
        transform: translateY(0%);
      }

      /* 認証関連のスタイル */
      #auth-page {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
        width: 100vw;
        background-color: #343a40;
      }

      .auth-container {
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        padding: 30px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        max-width: 400px;
        width: 100%;
        text-align: center;
      }

      .title {
        margin-bottom: 30px;
        font-size: 2rem;
      }

      .login-methods {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .custom-signin-button {
        background-color: white;
        color: #444;
        border-radius: 5px;
        border: none;
        padding: 10px 15px;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: background-color 0.3s;
      }

      .custom-signin-button:hover {
        background-color: #f1f1f1;
      }

      .custom-signin-button img {
        margin-right: 10px;
        width: 18px;
        height: 18px;
      }

      /* 追加した直接ログインボタン */
      .direct-login-btn {
        margin-top: 15px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        padding: 8px 15px;
        font-weight: bold;
        cursor: pointer;
        transition: background-color 0.3s;
        width: 100%;
        margin-bottom: 5px;
      }

      .direct-login-btn:hover {
        background-color: #0069d9;
      }

      .emergency-btn {
        margin-top: 20px;
        background-color: #dc3545;
        color: white;
        border: none;
        border-radius: 5px;
        padding: 8px 15px;
        font-weight: bold;
        cursor: pointer;
        transition: background-color 0.3s;
        width: 100%;
      }

      .emergency-btn:hover {
        background-color: #c82333;
      }

      #errorMessage {
        color: #ff6b6b;
        margin-top: 15px;
        display: none;
      }

      .hidden {
        display: none;
      }

      /* ホバーメニュー内にユーザー情報と操作ボタンを配置 */
      .user-auth-status {
        display: flex;
        align-items: center;
        font-size: 0.8rem;
        margin-left: auto;
        margin-right: 15px;
      }
      
      .user-email {
        margin-right: 10px;
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }
      
      .logout-btn {
        background-color: rgba(255, 255, 255, 0.2);
        color: white;
        border: none;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 0.75rem;
        cursor: pointer;
        transition: background-color 0.2s;
      }
      
      .logout-btn:hover {
        background-color: rgba(255, 255, 255, 0.3);
      }

      #loading-view {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      
      .divider {
        margin: 20px 0;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        width: 100%;
      }

      /* iframeに関する追加スタイル */
      .iframe-container {
        width: 100%;
        height: 100%;
        position: relative;
      }

      .iframe-fix-tooltip {
        position: absolute;
        top: 60px;
        left: 50%;
        transform: translateX(-50%);
        background-color: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 10px 15px;
        border-radius: 5px;
        z-index: 1000;
        font-size: 14px;
        width: auto;
        max-width: 80%;
        text-align: center;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        display: none;
      }

      .iframe-fix-tooltip.show {
        display: block;
        animation: fadeInOut 5s forwards;
      }

      @keyframes fadeInOut {
        0% { opacity: 0; }
        10% { opacity: 1; }
        90% { opacity: 1; }
        100% { opacity: 0; }
      }

      /* iframeのオーバーレイ */
      .iframe-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10;
      }

      .iframe-overlay-content {
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        max-width: 500px;
        width: 80%;
        color: #333;
        text-align: center;
      }

      .iframe-overlay-buttons {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 20px;
        flex-wrap: wrap;
      }

      /* ホバーメニュー内にアクションボタンを配置するためのスタイル */
      .action-button-group {
        display: flex;
        gap: 10px;
        margin-left: 10px;
      }

      .nav-action-button {
        background-color: rgba(255, 255, 255, 0.2);
        color: white;
        border: none;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 0.75rem;
        cursor: pointer;
        transition: background-color 0.2s;
        display: flex;
        align-items: center;
      }
      
      .nav-action-button:hover {
        background-color: rgba(255, 255, 255, 0.3);
      }
      
      .nav-action-button.refresh {
        background-color: rgba(40, 167, 69, 0.3);
      }
      
      .nav-action-button.refresh:hover {
        background-color: rgba(40, 167, 69, 0.5);
      }
      
      .nav-action-button.newtab {
        background-color: rgba(23, 162, 184, 0.3);
      }
      
      .nav-action-button.newtab:hover {
        background-color: rgba(23, 162, 184, 0.5);
      }

      /* iframeの周りにパディングを設定して完全表示を実現 */
      .iframe-padding-wrapper {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        padding: 5px; /* 最小限のパディングで表示領域を確保 */
      }
    </style>
  </head>

  <body>
    <!-- 認証ページ -->
    <div id="auth-page">
      <div class="auth-container">
        <h1 class="title">ARIEL ポータル</h1>
        
        <div id="login-view">
          <p>続行するには認証が必要です</p>
          
          <div class="login-methods">
            <!-- Google サインインボタン -->
            <div class="d-flex justify-content-center">
              <div id="g-signin2" class="g-signin2"></div>
            </div>
            
            <!-- または、カスタムデザインのボタン -->
            <button id="custom-signin-btn" class="custom-signin-button mt-3">
              <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" alt="Google logo">
              Googleアカウントでログイン
            </button>
            
            <!-- 直接ログインオプション（追加） -->
            <div class="divider"></div>
            <p class="small">または直接ログイン：</p>
            
            <button id="login-cz-btn" class="direct-login-btn">
              杉森 (cz) としてログイン
            </button>
            
            <button id="login-p-btn" class="direct-login-btn">
              杉森 (p) としてログイン
            </button>
            
            <button id="login-skyarch-btn" class="direct-login-btn">
              杉森 (skyarch) としてログイン
            </button>
            
            <!-- 緊急アクセスボタン -->
            <div class="divider"></div>
            <button id="emergency-access-btn" class="emergency-btn">
              緊急アクセス（管理者用）
            </button>
          </div>
          
          <div id="errorMessage"></div>
        </div>
        
        <div id="loading-view" class="hidden">
          <div class="d-flex justify-content-center">
            <div class="spinner-border text-light" role="status">
              <span class="sr-only">Loading...</span>
            </div>
          </div>
          <p class="mt-3">認証中...</p>
        </div>
      </div>
    </div>

    <!-- メインアプリ -->
    <div id="app"><!--appここから-->

      <!-- iframe全画面 -->
      <div class="fullscreen-appsheet" id="appsheet-container-99999" v-show="showContents[0] === '99999'">
        <div class="iframe-container">
          <!-- iframeの周りにパディングを設定 -->
          <div class="iframe-padding-wrapper">
            <iframe
              id="appsheet-iframe"
              ref="fullscreenFrame"
              :src="appsheetUrl"
              style="width: 100%; height: 100%; border: none;"
              scrolling="yes"
              allowfullscreen="true"
              allow="fullscreen; clipboard-read; clipboard-write; accelerometer; autoplay; camera; microphone; geolocation;"
              sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-top-navigation allow-modals"
              @load="handleIframeLoad"
              @error="handleIframeError">
            </iframe>
          </div>
          
          <!-- iframeのタイムアウトや読み込みエラーなどの問題時に表示するオーバーレイ -->
          <div class="iframe-overlay" v-if="iframeError">
            <div class="iframe-overlay-content">
              <h4>AppSheetの読み込みに問題が発生しました</h4>
              <p>以下のいずれかの方法をお試しください：</p>
              <div class="iframe-overlay-buttons">
                <button @click="reloadIframe" class="btn btn-primary">再読み込み</button>
                <button @click="openAppsheetInNewTab" class="btn btn-info">新しいタブで開く</button>
                <button @click="iframeError = false" class="btn btn-secondary">このメッセージを閉じる</button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- ツールチップ -->
        <div :class="['iframe-fix-tooltip', showTooltip ? 'show' : '']">
          {{ tooltipMessage }}
        </div>
      </div>

      <!-- ホバーゾーンとナビ -->
      <div id="nav-hover-zone" @mouseenter="showNav = true" @mouseleave="showNav = false"></div>
      <nav 
        id="nav-hover-bar"
        class="navbar navbar-expand-lg navbar-dark bg-secondary px-3"
        :class="{ active: showNav }"
        @mouseenter="showNav = true"
        @mouseleave="showNav = false">
        <h3 class="navbar-brand" @click="toggle('99999')">ARIEL</h3>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown"
            aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
        
        <!--ドロップダウンリストここから-->
        <div class="collapse navbar-collapse" id="navbarNavDropdown">
          <ul class="navbar-nav">
   
           <!--カテゴリ毎ドロップダウン(リンク)ここから-->
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" role="button" data-toggle="dropdown">Knowledge</a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                <a v-for="knowledge in knowledges" :key="knowledge.id" class="dropdown-item" v-bind:href="knowledge.url" target="_blank">{{knowledge.name}}</a>
              </div>
            </li>
            <!--カテゴリ毎ドロップダウン(リンク)ここまで-->
            
            <!--カテゴリ毎ドロップダウン(リンク)ここから-->
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" role="button" data-toggle="dropdown">Learning</a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                <a v-for="learning in learnings" :key="learning.id" class="dropdown-item" v-bind:href="learning.url" target="_blank">{{learning.name}}</a>
              </div>
            </li>
            <!--カテゴリ毎ドロップダウン(リンク)ここまで-->
        
            <!--カテゴリ毎ドロップダウン(リンク)ここから-->
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" role="button" data-toggle="dropdown">Drive</a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                <a v-for="drive in drives" :key="drive.id" class="dropdown-item" v-bind:href="drive.url" target="_blank">{{drive.name}}</a>
              </div>
            </li>
            <!--カテゴリ毎ドロップダウン(リンク)ここまで-->

            <!--カテゴリ毎ドロップダウン(リンク)ここから-->
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" role="button" data-toggle="dropdown">Google</a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                <a v-for="gsuite in gsuites" :key="gsuite.id" class="dropdown-item" v-bind:href="gsuite.url" target="_blank">{{gsuite.name}}</a>
              </div>
            </li>
            <!--カテゴリ毎ドロップダウン(リンク)ここまで-->

            <!--カテゴリ毎ドロップダウン(リンク)ここから-->
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" role="button" data-toggle="dropdown">App</a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                <a v-for="tool in tools" :key="tool.id" class="dropdown-item" v-bind:href="tool.url" target="_blank">{{tool.name}}</a>
              </div>
            </li>
            <!--カテゴリ毎ドロップダウン(リンク)ここまで-->

            <!--カテゴリ毎ドロップダウン(リンク)ここから-->
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" role="button" data-toggle="dropdown">IT</a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                <a v-for="it in its" :key="it.id" class="dropdown-item" v-bind:href="it.url" target="_blank">{{it.name}}</a>
              </div>
            </li>
            <!--カテゴリ毎ドロップダウン(リンク)ここまで-->

            <!--カテゴリ毎ドロップダウン(リンク)ここから-->
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" role="button" data-toggle="dropdown">Media</a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                <a v-for="tv in tvs" :key="tv.id" class="dropdown-item" v-bind:href="tv.url" target="_blank">{{tv.name}}</a>
              </div>
            </li>
            <!--カテゴリ毎ドロップダウン(リンク)ここまで-->

            <!--カテゴリ毎ドロップダウン(リンク)ここから-->
             <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" role="button" data-toggle="dropdown">SNS/Private</a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                <a v-for="prv in prvs" :key="prv.id" class="dropdown-item" v-bind:href="prv.url" target="_blank">{{prv.name}}</a>
              </div>
            </li>
            <!--カテゴリ毎ドロップダウン(リンク)ここまで-->
          </ul>
          
          <!-- アクションボタンをナビゲーションバー内に配置 -->
          <div class="action-button-group" v-if="showContents[0] === '99999'">
            <button @click="reloadIframe" class="nav-action-button refresh" title="AppSheetを再読み込み">
              ↻ 再読込
            </button>
            <button @click="openAppsheetInNewTab" class="nav-action-button newtab" title="新しいタブで開く">
              ↗ 新タブ
            </button>
          </div>
          
          <!-- ユーザー情報もナビゲーションバー内に配置 -->
          <div class="user-auth-status">
            <span class="user-email" id="nav-user-email">{{ userEmail }}</span>
            <button class="logout-btn" @click="logout">ログアウト</button>
          </div>
        </div>
        <!--ドロップダウンリストここまで-->
      </nav>
      <!--ナビバーここまで-->
      </br>
       
       <!--ドロップダウンに対するリアクションここから-->
        <div id="sub">
          <!-- 空のドロップダウン対応領域 -->
        </div>
        <!--ドロップダウンに対するリアクションここまで-->
      
    </div>
    <!--appここまで-->

    <script>
      // 許可するGoogleアカウントのメールアドレス（配列に追加して複数設定可能）
      const allowedEmails = [
        'k.sugimori.cz@gmail.com',
        'k.sugimori.p@gmail.com',
        'sugimori@skyarch.net'
        // 必要に応じて追加
      ];
      
      // エラーメッセージを表示
      function showError(message) {
        const errorElement = document.getElementById('errorMessage');
        errorElement.textContent = message;
        errorElement.style.display = 'block';
        
        hideLoading();
      }
      
      // ローディング表示の切り替え
      function showLoading() {
        document.getElementById('login-view').classList.add('hidden');
        document.getElementById('loading-view').classList.remove('hidden');
      }
      
      function hideLoading() {
        document.getElementById('login-view').classList.remove('hidden');
        document.getElementById('loading-view').classList.add('hidden');
      }
      
      // メインアプリの表示
      function showApp(userEmail) {
        console.log('showApp関数が呼び出されました。メールアドレス:', userEmail);
        
        // 認証ページを非表示
        document.getElementById('auth-page').style.display = 'none';
        
        // メインアプリを表示
        document.getElementById('app').style.display = 'block';
        
        // Vue.jsアプリにメールアドレスを渡す
        if (window.app) {
          window.app.userEmail = userEmail;
        }
      }
      
      // ログアウト関数
      function logout() {
        // ローカルストレージから認証情報を削除
        localStorage.removeItem('ariel_auth_token');
        localStorage.removeItem('ariel_email');
        localStorage.removeItem('ariel_emergency');
        
        // ページをリロード
        window.location.reload();
      }
      
      // 直接ログイン機能
      function directLogin(email) {
        console.log('直接ログイン: ', email);
        
        // ローディング表示
        showLoading();
        
        // 認証情報を保存
        localStorage.setItem('ariel_email', email);
        localStorage.setItem('ariel_auth_token', 'direct_' + Date.now());
        
        // メイン画面表示
        setTimeout(() => {
          showApp(email);
        }, 500);
      }
      
      // 緊急アクセス機能
      function emergencyAccess() {
        console.log('緊急アクセス実行');
        
        // AppSheetを別タブで開く
        window.open('https://www.appsheet.com/start/b3cc011c-f2d9-4021-b16f-2efdd921a42b', '_blank');
        
        // 緊急フラグを保存
        localStorage.setItem('ariel_emergency', 'true');
        
        // メイン画面表示
        showApp('緊急アクセスモード');
      }
      
      // ページ読み込み時に実行
      document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM読み込み完了');
        
        // ローカルストレージのチェック
        const email = localStorage.getItem('ariel_email');
        const token = localStorage.getItem('ariel_auth_token');
        const emergency = localStorage.getItem('ariel_emergency');
        
        // ボタンにイベントリスナーを設定
        document.getElementById('login-cz-btn').addEventListener('click', function() {
          directLogin('k.sugimori.cz@gmail.com');
        });
        
        document.getElementById('login-p-btn').addEventListener('click', function() {
          directLogin('k.sugimori.p@gmail.com');
        });
        
        document.getElementById('login-skyarch-btn').addEventListener('click', function() {
          directLogin('sugimori@skyarch.net');
        });
        
        document.getElementById('emergency-access-btn').addEventListener('click', function() {
          emergencyAccess();
        });
        
        document.getElementById('custom-signin-btn').addEventListener('click', function() {
          // Googleサインインの代わりに、とりあえず直接ログイン
          directLogin('k.sugimori.cz@gmail.com');
        });
        
        // 認証済みかチェック
        if ((email && token) || emergency === 'true') {
          console.log('認証情報を検出: ', email || '緊急アクセス');
          showApp(email || '緊急アクセスモード');
        }
      });
      
      // Vue インスタンス作成
      window.app = new Vue({
        el:"#app",
        data:{
           knowledges:[
            {id:"0001",name:"Chat-GPT",url:"https://chatgpt.com/"},
            {id:"0002",name:"Flier",url:"https://www.flierinc.com/"},
            {id:"0003",name:"Googleニュース",url:"https://news.google.com/"},
            {id:"0004",name:"経済レポート",url:"http://www3.keizaireport.com/"},
            {id:"0005",name:"朝日新聞",url:"https://www.asahi.com/?iref=pc_gnavi"},
            {id:"0006",name:"NHKニュース",url:"https://www3.nhk.or.jp/news/"},
            {id:"0007",name:"ハフポス",url:"https://www.huffingtonpost.jp/"},
            {id:"0008",name:"東洋経済",url:"https://toyokeizai.net/"},
            {id:"0009",name:"CNN",url:"https://www.cnn.co.jp/"},
            {id:"0010",name:"GIGAZINE",url:"https://gigazine.net/"},   
          ],
          learnings:[
            {id:"1001",name:"Schoo",url:"https://schoo.jp/"},
            {id:"1002",name:"JMOOC",url:"https://www.jmooc.jp/"},
            {id:"1003",name:"Progate",url:"https://prog-8.com/dashboard"},
            {id:"1004",name:"Udemy",url:"https://www.udemy.com/"},
          ],
          drives:[
            {id:"2001",name:"Frames",url:"https://drive.google.com/drive/u/0/folders/1T8Fr9Q_svATBleRkEWiVN9GmO6s3zcsb"},
            {id:"2002",name:"MyDrive",url:"https://drive.google.com/drive/u/0/my-drive"},
            {id:"2003",name:"swordFishⅢ",url:"https://drive.google.com/drive/u/0/folders/1JdY8rZA2e1sUW9wQ3oyHj6Jbx60aMxL8"},
            {id:"2004",name:"DropBox",url:"https://www.dropbox.com/home"},
          ],
          gsuites:[
            {id:"3001",name:"Gmail",url:"https://mail.google.com/mail/u/1/#inbox"},
            {id:"3002",name:"GooglePhoto",url:"https://photos.google.com/u/1/?referrer=GPU&pageId=none"},
            {id:"3003",name:"Google Calendar",url:"https://calendar.google.com/calendar/r?cid=ajJkcTlrNzJpY3VrbGMzaTI1aDhnYzFyMW9AZ3JvdXAuY2FsZW5kYXIuZ29vZ2xlLmNvbQ"},
            {id:"3004",name:"Google Keep",url:"https://keep.google.com/u/0/#home"},
          ],
          tools:[
            {id:"4001",name:"Chat-GPT",url:"https://chatgpt.com/"},
            {id:"4002",name:"Claude",url:"https://claude.ai/new"},
            {id:"4003",name:"Dify",url:"https://cloud.dify.ai/apps"},
            {id:"4004",name:"Trello",url:"https://trello.com/b/9J0Xza0u/%E6%9D%89%E6%A3%AE%E3%81%AE%E3%83%9C%E3%83%BC%E3%83%89"},
            {id:"4005",name:"AppSheet",url:"https://www.appsheet.com/Template/Apps "},
            {id:"4006",name:"Canva",url:"https://www.canva.com/ja_jp/"},
            {id:"4007",name:"draw.io",url:"https://www.draw.io/"},
            {id:"4008",name:"NetPrint",url:"https://networkprint.ne.jp/sharp_netprint/ja/mypage.aspx"},
            {id:"4009",name:"icooon-mono",url:"https://icooon-mono.com/"},
          ],
          its:[
            {id:"5001",name:"Github",url:"https://github.com/"},
            {id:"5002",name:"Qiita",url:"https://qiita.com/"},
            {id:"5003",name:"GoogleAppsScript",url:"https://developers.google.com/apps-script/reference"},
            {id:"5004",name:"Vue.js",url:"https://012-jp.vuejs.org/guide/"},
            {id:"5005",name:"Bootstrap",url:"https://getbootstrap.jp/docs/4.2/getting-started/introduction/"},
          ],
          tvs:[
            {id:"6001",name:"Abemaニュース",url:"https://abema.tv/now-on-air/abema-news"},
            {id:"6002",name:"Netflix",url:"https://www.netflix.com/browse/my-list"},
            {id:"6003",name:"AmazonPrime",url:"https://www.amazon.co.jp/gp/video/mystuff/ref=atv_nb_mystuff"},
            {id:"6004",name:"U-Next",url:"https://video.unext.jp/"},
            {id:"6005",name:"Disney+",url:"https://www.disneyplus.com/ja-jp/home"},
            {id:"6006",name:"NHKオンデマンド",url:"https://www.nhk-ondemand.jp/#/0/"},
            {id:"6007",name:"Youtubeライブラリ",url:"https://www.youtube.com/feed/library"},
            {id:"6008",name:"Youtubeミュージック",url:"https://music.youtube.com/"},
            {id:"6009",name:"ニコニコ動画",url:"https://www.nicovideo.jp/my/mylist?cmnhd_ref=device%3Dpc%26site%3Dniconico%26pos%3Duserpanel%26page%3Dtop"},
            {id:"6010",name:"Pixiv",url:"https://www.pixiv.net/"},
          ],
          prvs:[
            {id:"7001",name:"Twitter",url:"https://twitter.com/home"},
            {id:"7002",name:"七尾えみ Channel",url:"https://www.youtube.com/channel/UCNpaS7EteiT1IFigRBfW6eg"},
            {id:"7003",name:"Mirrativ配信画面",url:"https://www.mirrativ.com/"},
            {id:"7004",name:"はてなブックマーク",url:"https://b.hatena.ne.jp/hantenasgmr/bookmark"},
            {id:"7005",name:"Facebook",url:"https://www.facebook.com/"},
            {id:"7006",name:"楽天銀行",url:"https://fes.rakuten-bank.co.jp/MS/main/RbS?CurrentPageID=START&&COMMAND=LOGIN"},
            {id:"7007",name:"七尾えみFRX",url:"https://hub.vroid.com/characters/679022379978810834/models/522769586827415511"},
          ],
          showContents:["99999"],
          showNav: true,
          iframeError: false,
          alreadyOpened: false,
          tooltipMessage: '',
          showTooltip: false,
          appsheetUrl: 'https://www.appsheet.com/start/b3cc011c-f2d9-4021-b16f-2efdd921a42b',
          iframeLoadCount: 0,
          iframeLoaded: false,
          userEmail: '' // ユーザーメールアドレスをVueで管理
        },
        watch: {
          showNav(newVal) {
            const iframe = this.$refs.fullscreenFrame;
            if (iframe) {
              iframe.style.pointerEvents = newVal ? 'none' : 'auto';
            }
          }
        },
        mounted() {
          window.addEventListener('mousemove', this.handleMouseMove);
          
          // iframe表示の最適化
          this.optimizeIframeDisplay();
          
          // ユーザーメールアドレスを初期化
          const email = localStorage.getItem('ariel_email');
          const emergency = localStorage.getItem('ariel_emergency');
          this.userEmail = email || (emergency === 'true' ? '緊急アクセスモード' : 'ゲスト');
        },
        beforeDestroy() {
          window.removeEventListener('mousemove', this.handleMouseMove);
        },
        methods:{
          handleMouseMove(e) {
            const y = e.clientY;
            this.showNav = (y < 30); // ホバーゾーンの高さに合わせる
          },
          toggle: function(data) {
            this.showContents = [data];
            this.alreadyOpened = false;
            this.iframeError = false;
            
            // iframe表示の最適化
            this.$nextTick(() => {
              this.optimizeIframeDisplay();
            });
          },
          
          // iframe表示の最適化
          optimizeIframeDisplay() {
            const iframe = document.getElementById('appsheet-iframe');
            if (!iframe) return;
            
            // iframeにパディングを追加して「Entire app must be in view」エラーを回避
            this.showTooltip = true;
            this.tooltipMessage = 'AppSheetを読み込んでいます...';
            
            setTimeout(() => {
              this.showTooltip = false;
            }, 5000);
            
            // ブラウザの全画面表示を促す
            try {
              // iframe要素がビューポート全体を占めるようにスタイルを調整
              // AppSheetが完全に表示されるようにパディングを設定
              iframe.style.width = '100%';
              iframe.style.height = '100%';
              iframe.style.position = 'relative';
              iframe.style.boxSizing = 'border-box';
              
              // スクロールを0に設定して完全表示を確保
              window.scrollTo(0, 0);
              
              // ウィンドウリサイズイベントでiframeのサイズを調整
              window.addEventListener('resize', () => {
                window.scrollTo(0, 0);
              });
              
            } catch (e) {
              console.error('iframeの最適化中にエラーが発生しました:', e);
            }
          },
          
          // iframeのロードハンドラ
          handleIframeLoad() {
            console.log('iframeがロードされました');
            this.iframeLoaded = true;
            this.iframeLoadCount++;
            
            // 「Entire app must be in view」エラーメッセージが表示された場合の対応
            const iframe = this.$refs.fullscreenFrame;
            if (!iframe) return;
            
            // iframe全体が表示されるようスクロールを調整
            try {
              // iframeが画面内に完全に表示されるようスクロール位置を調整
              window.scrollTo(0, 0);
              
              // iframe内のドキュメントにアクセスできるか試みる
              setTimeout(() => {
                try {
                  const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                  const errorMessages = iframeDoc.querySelectorAll('div, p, span');
                  
                  // エラーメッセージが表示されているか確認
                  let hasViewError = false;
                  
                  errorMessages.forEach(el => {
                    if (el.textContent && el.textContent.includes('Entire app must be in view')) {
                      hasViewError = true;
                    }
                  });
                  
                  if (hasViewError) {
                    // エラーメッセージが見つかった場合、ヘルパーメッセージを表示
                    this.showTooltip = true;
                    this.tooltipMessage = 'アプリ全体が表示されていません。ナビゲーションバーにある再読込ボタンをお試しください。';
                    
                    setTimeout(() => {
                      this.showTooltip = false;
                    }, 10000);
                  }
                } catch (e) {
                  // クロスオリジンポリシーによりアクセスできない場合はスキップ
                  console.warn('iframeのcontentDocumentにアクセスできません:', e);
                }
              }, 1000);
            } catch (e) {
              console.error('iframeのロード後の処理でエラーが発生しました:', e);
            }
          },
          
          // iframeのエラーハンドラ
          handleIframeError(e) {
            console.error('iframeでエラーが発生しました:', e);
            this.iframeError = true;
          },
          
          // iframeを再読み込み
          reloadIframe() {
            // iframeのURL属性を再設定して強制的に再読み込み
            const iframe = this.$refs.fullscreenFrame;
            if (iframe) {
              // 現在のURLに時間パラメータを付加して強制的にリロード
              this.appsheetUrl = `https://www.appsheet.com/start/b3cc011c-f2d9-4021-b16f-2efdd921a42b?reload=${Date.now()}`;
              
              // エラー状態をリセット
              this.iframeError = false;
              this.iframeLoaded = false;
              
              // ヘルパーメッセージを表示
              this.showTooltip = true;
              this.tooltipMessage = 'AppSheetを再読み込みしています...';
              
              setTimeout(() => {
                this.showTooltip = false;
              }, 5000);
            }
          },
          
          // AppSheetを新しいタブで開く
          openAppsheetInNewTab() {
            window.open('https://www.appsheet.com/start/b3cc011c-f2d9-4021-b16f-2efdd921a42b', '_blank');
            this.alreadyOpened = true;
            
            // ヘルパーメッセージを表示
            this.showTooltip = true;
            this.tooltipMessage = 'AppSheetを新しいタブで開きました';
            
            setTimeout(() => {
              this.showTooltip = false;
            }, 3000);
          },
          
          // ログアウト処理
          logout() {
            // ローカルストレージから認証情報を削除
            localStorage.removeItem('ariel_auth_token');
            localStorage.removeItem('ariel_email');
            localStorage.removeItem('ariel_emergency');
            
            // ページをリロード
            window.location.reload();
          }
        }
      });
    </script>
  </body>
</html>
